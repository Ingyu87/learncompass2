<!doctype html>

<html lang="ko" class="h-full">

 <head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ë°°ì›€ë‚˜ì¹¨ë°˜ LearnCompass</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="/_sdk/data_sdk.js"></script>

  <script src="/_sdk/element_sdk.js"></script>

  <style>

        body {

            box-sizing: border-box;

        }

        .gradient-bg {

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

        }

        .card-shadow {

            box-shadow: 0 10px 25px rgba(0,0,0,0.1);

        }

        .safety-indicator {

            animation: pulse 2s infinite;

        }

        @keyframes pulse {

            0%, 100% { opacity: 1; }

            50% { opacity: 0.7; }

        }

    </style>

  <style>@view-transition { navigation: auto; }</style>

 </head>

 <body class="h-full bg-gray-50">

  <div class="min-h-full"><!-- Header -->

   <header class="gradient-bg text-white shadow-lg">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

     <div class="flex items-center justify-between">

      <div class="flex items-center space-x-3">

       <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center"><span class="text-2xl">ğŸ§­</span>

       </div>

       <div>

        <h1 id="platform-title" class="text-2xl font-bold">ë°°ì›€ë‚˜ì¹¨ë°˜ LearnCompass</h1>

        <p id="welcome-message" class="text-blue-100">ì•ˆì „í•˜ê³  ì¦ê±°ìš´ AI í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>

       </div>

      </div>

      <div class="flex items-center space-x-2">

       <div class="safety-indicator bg-green-400 w-3 h-3 rounded-full"></div><span class="text-sm">ì•ˆì „ ëª¨ë“œ í™œì„±</span>

      </div>

     </div>

    </div>

   </header>

   <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Student Interface -->

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><!-- Learning Setup Panel -->

     <div class="lg:col-span-1">

      <div class="bg-white rounded-xl card-shadow p-6 mb-6">

       <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">ğŸ“š</span> í•™ìŠµ ì„¤ì •</h2>

       <form id="learning-setup" class="space-y-4">

        <div><label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">í•™ìƒ ì´ë¦„</label> <input type="text" id="student-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">

        </div>

        <div><label for="grade-select" class="block text-sm font-medium text-gray-700 mb-1">í•™ë…„</label> <select id="grade-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">í•™ë…„ ì„ íƒ</option> <option value="1í•™ë…„">1í•™ë…„</option> <option value="2í•™ë…„">2í•™ë…„</option> <option value="3í•™ë…„">3í•™ë…„</option> <option value="4í•™ë…„">4í•™ë…„</option> <option value="5í•™ë…„">5í•™ë…„</option> <option value="6í•™ë…„">6í•™ë…„</option> </select>

        </div>

        <div><label for="subject-select" class="block text-sm font-medium text-gray-700 mb-1">ê³¼ëª©</label> <select id="subject-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">ê³¼ëª© ì„ íƒ</option> <option value="êµ­ì–´">êµ­ì–´</option> <option value="ìˆ˜í•™">ìˆ˜í•™</option> <option value="ê³¼í•™">ê³¼í•™</option> <option value="ì‚¬íšŒ">ì‚¬íšŒ</option> <option value="ì˜ì–´">ì˜ì–´</option> <option value="ë¯¸ìˆ ">ë¯¸ìˆ </option> <option value="ìŒì•…">ìŒì•…</option> <option value="ì²´ìœ¡">ì²´ìœ¡</option> </select>

        </div>

        <div><label for="learning-objective" class="block text-sm font-medium text-gray-700 mb-1">í•™ìŠµ ëª©í‘œ</label> <textarea id="learning-objective" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ì˜¤ëŠ˜ ë°°ìš°ê³  ì‹¶ì€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>

        </div>

       </form>

      </div><!-- Safety Guidelines -->

      <div class="bg-green-50 border border-green-200 rounded-xl p-4">

       <h3 class="font-semibold text-green-800 mb-2 flex items-center"><span class="mr-2">ğŸ›¡ï¸</span> ì•ˆì „ ìˆ˜ì¹™</h3>

       <ul class="text-sm text-green-700 space-y-1">

        <li>â€¢ ê°œì¸ì •ë³´ëŠ” ì ˆëŒ€ ì…ë ¥í•˜ì§€ ë§ˆì„¸ìš”</li>

        <li>â€¢ í•™ìŠµ ëª©í‘œì— ë§ëŠ” ì§ˆë¬¸ë§Œ í•´ì£¼ì„¸ìš”</li>

        <li>â€¢ ë¶€ì ì ˆí•œ ë‚´ìš©ì€ ìë™ìœ¼ë¡œ ì°¨ë‹¨ë©ë‹ˆë‹¤</li>

        <li>â€¢ ì„ ìƒë‹˜ì´ ëª¨ë“  ëŒ€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”</li>

       </ul>

      </div>

     </div><!-- AI Chat Interface -->

     <div class="lg:col-span-2">

      <div class="bg-white rounded-xl card-shadow h-96 flex flex-col">

       <div class="p-4 border-b border-gray-200">

        <h2 class="text-xl font-bold text-gray-800 flex items-center"><span class="mr-2">ğŸ¤–</span> AI í•™ìŠµ ë„ìš°ë¯¸</h2>

        <div id="current-objective" class="text-sm text-gray-600 mt-1">

         í•™ìŠµ ëª©í‘œë¥¼ ì„¤ì •í•˜ë©´ AIì™€ ëŒ€í™”í•  ìˆ˜ ìˆì–´ìš”!

        </div>

       </div>

       <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4">

        <div class="flex items-start space-x-3">

         <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"><span class="text-sm">ğŸ¤–</span>

         </div>

         <div class="bg-blue-50 rounded-lg p-3 max-w-md">

          <p class="text-sm text-gray-800">ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì—¬ëŸ¬ë¶„ì˜ í•™ìŠµì„ ë„ì™€ì£¼ëŠ” AI ì„ ìƒë‹˜ì´ì—ìš”. ë¨¼ì € í•™ìŠµ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”!</p>

         </div>

        </div>

       </div>

       <div class="p-4 border-t border-gray-200">

        <div class="flex space-x-2"><input type="text" id="user-question" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”..." disabled> <button id="send-question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled> ì „ì†¡ </button>

        </div>

        <div id="safety-warning" class="hidden mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700">

         âš ï¸ í•™ìŠµ ëª©í‘œì™€ ê´€ë ¨ì—†ëŠ” ì§ˆë¬¸ì´ê±°ë‚˜ ë¶€ì ì ˆí•œ ë‚´ìš©ì…ë‹ˆë‹¤.

        </div>

       </div>

      </div>

     </div>

    </div><!-- Teacher Dashboard -->

    <div class="mt-12">

     <div class="bg-white rounded-xl card-shadow p-6">

      <div class="flex items-center justify-between mb-6">

       <h2 class="text-xl font-bold text-gray-800 flex items-center"><span class="mr-2">ğŸ‘©â€ğŸ«</span> êµì‚¬ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h2>

       <div class="flex items-center space-x-4"><span class="text-sm text-gray-600">ì´ ëŒ€í™” ìˆ˜: <span id="total-conversations" class="font-semibold">0</span></span> <button id="export-data" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"> ë°ì´í„° ë‚´ë³´ë‚´ê¸° </button>

       </div>

      </div>

      <div id="admin-notice-display" class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">

       ê´€ë¦¬ì ê³µì§€ì‚¬í•­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.

      </div>

      <div class="overflow-x-auto">

       <table class="w-full text-sm">

        <thead class="bg-gray-50">

         <tr>

          <th class="px-4 py-3 text-left font-medium text-gray-700">ì‹œê°„</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">í•™ìƒ</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">ê³¼ëª©</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">í•™ìŠµëª©í‘œ</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">ì§ˆë¬¸</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">ì•ˆì „ì„±</th>

          <th class="px-4 py-3 text-left font-medium text-gray-700">ìŠ¹ì¸</th>

         </tr>

        </thead>

        <tbody id="conversation-log" class="divide-y divide-gray-200">

         <tr>

          <td colspan="7" class="px-4 py-8 text-center text-gray-500">ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>

         </tr>

        </tbody>

       </table>

      </div>

     </div>

    </div>

   </main>

  </div>

  <script>

        // Configuration

        const defaultConfig = {

            platform_title: "ë°°ì›€ë‚˜ì¹¨ë°˜ LearnCompass",

            welcome_message: "ì•ˆì „í•˜ê³  ì¦ê±°ìš´ AI í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”!",

            admin_notice: "ê´€ë¦¬ì ê³µì§€ì‚¬í•­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."

        };



        let currentData = [];

        let isLoading = false;



        // Data SDK Handler

        const dataHandler = {

            onDataChanged(data) {

                currentData = data;

                updateConversationLog();

                updateTotalCount();

            }

        };



        // Element SDK Configuration

        async function onConfigChange(config) {

            const platformTitle = config.platform_title || defaultConfig.platform_title;

            const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;

            const adminNotice = config.admin_notice || defaultConfig.admin_notice;



            document.getElementById('platform-title').textContent = platformTitle;

            document.getElementById('welcome-message').textContent = welcomeMessage;

            document.getElementById('admin-notice-display').textContent = adminNotice;

        }



        function mapToCapabilities(config) {

            return {

                recolorables: [

                    {

                        get: () => config.primary_color || "#667eea",

                        set: (value) => {

                            config.primary_color = value;

                            window.elementSdk.setConfig({ primary_color: value });

                        }

                    }

                ],

                borderables: [],

                fontEditable: {

                    get: () => config.font_family || "Inter",

                    set: (value) => {

                        config.font_family = value;

                        window.elementSdk.setConfig({ font_family: value });

                    }

                },

                fontSizeable: {

                    get: () => config.font_size || 16,

                    set: (value) => {

                        config.font_size = value;

                        window.elementSdk.setConfig({ font_size: value });

                    }

                }

            };

        }



        function mapToEditPanelValues(config) {

            return new Map([

                ["platform_title", config.platform_title || defaultConfig.platform_title],

                ["welcome_message", config.welcome_message || defaultConfig.welcome_message],

                ["admin_notice", config.admin_notice || defaultConfig.admin_notice]

            ]);

        }



        // Initialize SDKs

        async function initializeApp() {

            try {

                if (window.elementSdk) {

                    await window.elementSdk.init({

                        defaultConfig,

                        onConfigChange,

                        mapToCapabilities,

                        mapToEditPanelValues

                    });

                }



                if (window.dataSdk) {

                    const result = await window.dataSdk.init(dataHandler);

                    if (!result.isOk) {

                        console.error("Data SDK ì´ˆê¸°í™” ì‹¤íŒ¨");

                    }

                }

            } catch (error) {

                console.error("ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:", error);

            }

        }



        // Safety and Content Filtering

        function checkSafety(question, learningObjective) {

            const inappropriateKeywords = ['ê°œì¸ì •ë³´', 'ì£¼ì†Œ', 'ì „í™”ë²ˆí˜¸', 'ë¹„ë°€ë²ˆí˜¸', 'í­ë ¥', 'ìš•ì„¤'];

            const questionLower = question.toLowerCase();

            

            // Check for inappropriate content

            for (let keyword of inappropriateKeywords) {

                if (questionLower.includes(keyword)) {

                    return { safe: false, reason: 'ë¶€ì ì ˆí•œ ë‚´ìš© í¬í•¨' };

                }

            }

            

            // Check relevance to learning objective (simplified)

            if (learningObjective && question.length > 5) {

                return { safe: true, reason: 'ì•ˆì „' };

            }

            

            return { safe: false, reason: 'í•™ìŠµ ëª©í‘œì™€ ë¬´ê´€' };

        }



        // Generate AI Response (Simulated)

        function generateAIResponse(question, subject, grade, learningObjective) {

            const responses = {

                'ìˆ˜í•™': [

                    'ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”! ìˆ˜í•™ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì°¨ê·¼ì°¨ê·¼ í’€ì–´ë³´ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.',

                    'ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë¨¼ì € ì£¼ì–´ì§„ ì¡°ê±´ì„ ì •ë¦¬í•´ë³¼ê¹Œìš”?',

                    'ìˆ˜í•™ì  ì‚¬ê³ ë ¥ì„ ê¸°ë¥´ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì ‘ê·¼í•´ë³´ì„¸ìš”!'

                ],

                'êµ­ì–´': [

                    'ê¸€ì„ ì½ì„ ë•ŒëŠ” ì£¼ì¸ê³µì˜ ë§ˆìŒì„ ìƒê°í•´ë³´ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”.',

                    'ì´ ë¬¸ì¥ì—ì„œ ì¤‘ìš”í•œ ë‹¨ì–´ë“¤ì„ ì°¾ì•„ë³´ì„¸ìš”.',

                    'ì‘ê°€ê°€ ì „ë‹¬í•˜ê³  ì‹¶ì€ ë©”ì‹œì§€ê°€ ë¬´ì—‡ì¸ì§€ ìƒê°í•´ë³´ì„¸ìš”!'

                ],

                'ê³¼í•™': [

                    'ê³¼í•™ì€ ê´€ì°°ê³¼ ì‹¤í—˜ì„ í†µí•´ ë°°ìš°ëŠ” ê³¼ëª©ì´ì—ìš”!',

                    'ìì—° í˜„ìƒì„ ìì„¸íˆ ê´€ì°°í•´ë³´ë©´ ë§ì€ ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆì–´ìš”.',

                    'ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ë©´ ê°€ì„¤ì„ ì„¸ìš°ê³  í™•ì¸í•´ë³´ì„¸ìš”!'

                ]

            };

            

            const subjectResponses = responses[subject] || [

                'í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì´ë„¤ìš”! í•¨ê»˜ ì•Œì•„ë³´ë„ë¡ í•´ìš”.',

                'í•™ìŠµ ëª©í‘œì— ë§ëŠ” ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤!',

                'ë” ìì„¸íˆ ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ ì„ ìƒë‹˜ê»˜ ë¬¼ì–´ë³´ì„¸ìš”!'

            ];

            

            return subjectResponses[Math.floor(Math.random() * subjectResponses.length)];

        }



        // UI Functions

        function enableChatInterface() {

            const userQuestion = document.getElementById('user-question');

            const sendButton = document.getElementById('send-question');

            

            userQuestion.disabled = false;

            sendButton.disabled = false;

            userQuestion.placeholder = 'ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”...';

        }



        function updateCurrentObjective() {

            const objective = document.getElementById('learning-objective').value;

            const subject = document.getElementById('subject-select').value;

            const grade = document.getElementById('grade-select').value;

            

            if (objective && subject && grade) {

                document.getElementById('current-objective').textContent = 

                    `${grade} ${subject} - ${objective}`;

                enableChatInterface();

            }

        }



        function addChatMessage(sender, message, isUser = false) {

            const chatMessages = document.getElementById('chat-messages');

            const messageDiv = document.createElement('div');

            messageDiv.className = 'flex items-start space-x-3';

            

            if (isUser) {

                messageDiv.className += ' flex-row-reverse space-x-reverse';

            }

            

            messageDiv.innerHTML = `

                <div class="w-8 h-8 ${isUser ? 'bg-green-100' : 'bg-blue-100'} rounded-full flex items-center justify-center">

                    <span class="text-sm">${isUser ? 'ğŸ‘¦' : 'ğŸ¤–'}</span>

                </div>

                <div class="${isUser ? 'bg-green-50' : 'bg-blue-50'} rounded-lg p-3 max-w-md">

                    <p class="text-sm text-gray-800">${message}</p>

                </div>

            `;

            

            chatMessages.appendChild(messageDiv);

            chatMessages.scrollTop = chatMessages.scrollHeight;

        }



        async function handleQuestionSubmit() {

            if (isLoading) return;

            

            const question = document.getElementById('user-question').value.trim();

            const studentName = document.getElementById('student-name').value;

            const grade = document.getElementById('grade-select').value;

            const subject = document.getElementById('subject-select').value;

            const learningObjective = document.getElementById('learning-objective').value;

            

            if (!question || !studentName || !grade || !subject || !learningObjective) {

                showSafetyWarning('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                return;

            }



            if (currentData.length >= 999) {

                showSafetyWarning('ìµœëŒ€ 999ê°œì˜ ëŒ€í™”ë§Œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë¶€ ê¸°ë¡ì„ ì‚­ì œí•´ì£¼ì„¸ìš”.');

                return;

            }

            

            // Safety check

            const safetyCheck = checkSafety(question, learningObjective);

            if (!safetyCheck.safe) {

                showSafetyWarning(`${safetyCheck.reason}`);

                return;

            }

            

            // Show loading

            isLoading = true;

            const sendButton = document.getElementById('send-question');

            sendButton.textContent = 'ì „ì†¡ ì¤‘...';

            sendButton.disabled = true;

            

            // Add user message

            addChatMessage('user', question, true);

            

            // Generate AI response

            const aiResponse = generateAIResponse(question, subject, grade, learningObjective);

            

            // Add AI response after delay

            setTimeout(async () => {

                addChatMessage('ai', aiResponse, false);

                

                // Save to database

                const conversationData = {

                    id: Date.now().toString(),

                    student_name: studentName,

                    grade: grade,

                    subject: subject,

                    learning_objective: learningObjective,

                    question: question,

                    ai_response: aiResponse,

                    safety_status: safetyCheck.reason,

                    timestamp: new Date().toISOString(),

                    teacher_approved: false

                };

                

                const result = await window.dataSdk.create(conversationData);

                if (!result.isOk) {

                    console.error('ëŒ€í™” ì €ì¥ ì‹¤íŒ¨');

                }

                

                // Reset form

                document.getElementById('user-question').value = '';

                isLoading = false;

                sendButton.textContent = 'ì „ì†¡';

                sendButton.disabled = false;

                hideSafetyWarning();

            }, 1000);

        }



        function showSafetyWarning(message) {

            const warning = document.getElementById('safety-warning');

            warning.textContent = `âš ï¸ ${message}`;

            warning.classList.remove('hidden');

        }



        function hideSafetyWarning() {

            document.getElementById('safety-warning').classList.add('hidden');

        }



        function updateConversationLog() {

            const tbody = document.getElementById('conversation-log');

            

            if (currentData.length === 0) {

                tbody.innerHTML = `

                    <tr>

                        <td colspan="7" class="px-4 py-8 text-center text-gray-500">

                            ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.

                        </td>

                    </tr>

                `;

                return;

            }

            

            tbody.innerHTML = currentData.map(item => `

                <tr class="hover:bg-gray-50">

                    <td class="px-4 py-3 text-gray-600">

                        ${new Date(item.timestamp).toLocaleString('ko-KR')}

                    </td>

                    <td class="px-4 py-3 font-medium">${item.student_name} (${item.grade})</td>

                    <td class="px-4 py-3">${item.subject}</td>

                    <td class="px-4 py-3 max-w-xs truncate" title="${item.learning_objective}">

                        ${item.learning_objective}

                    </td>

                    <td class="px-4 py-3 max-w-xs truncate" title="${item.question}">

                        ${item.question}

                    </td>

                    <td class="px-4 py-3">

                        <span class="px-2 py-1 text-xs rounded-full ${

                            item.safety_status === 'ì•ˆì „' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'

                        }">

                            ${item.safety_status}

                        </span>

                    </td>

                    <td class="px-4 py-3">

                        <button onclick="toggleApproval('${item.__backendId}')" 

                                class="px-3 py-1 text-xs rounded ${

                                    item.teacher_approved ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'

                                } hover:opacity-80">

                            ${item.teacher_approved ? 'ìŠ¹ì¸ë¨' : 'ìŠ¹ì¸'}

                        </button>

                    </td>

                </tr>

            `).join('');

        }



        async function toggleApproval(backendId) {

            const item = currentData.find(d => d.__backendId === backendId);

            if (!item) return;

            

            const updatedItem = { ...item, teacher_approved: !item.teacher_approved };

            const result = await window.dataSdk.update(updatedItem);

            

            if (!result.isOk) {

                console.error('ìŠ¹ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');

            }

        }



        function updateTotalCount() {

            document.getElementById('total-conversations').textContent = currentData.length;

        }



        function exportData() {

            const csvContent = [

                ['ì‹œê°„', 'í•™ìƒëª…', 'í•™ë…„', 'ê³¼ëª©', 'í•™ìŠµëª©í‘œ', 'ì§ˆë¬¸', 'AIì‘ë‹µ', 'ì•ˆì „ì„±', 'ìŠ¹ì¸ì—¬ë¶€'],

                ...currentData.map(item => [

                    new Date(item.timestamp).toLocaleString('ko-KR'),

                    item.student_name,

                    item.grade,

                    item.subject,

                    item.learning_objective,

                    item.question,

                    item.ai_response,

                    item.safety_status,

                    item.teacher_approved ? 'ìŠ¹ì¸ë¨' : 'ë¯¸ìŠ¹ì¸'

                ])

            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

            

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });

            const link = document.createElement('a');

            link.href = URL.createObjectURL(blob);

            link.download = `ë°°ì›€ë‚˜ì¹¨ë°˜_ëŒ€í™”ê¸°ë¡_${new Date().toISOString().split('T')[0]}.csv`;

            link.click();

        }



        // Event Listeners

        document.addEventListener('DOMContentLoaded', () => {

            initializeApp();

            

            // Learning setup change listeners

            ['student-name', 'grade-select', 'subject-select', 'learning-objective'].forEach(id => {

                document.getElementById(id).addEventListener('change', updateCurrentObjective);

                document.getElementById(id).addEventListener('input', updateCurrentObjective);

            });

            

            // Chat functionality

            document.getElementById('send-question').addEventListener('click', handleQuestionSubmit);

            document.getElementById('user-question').addEventListener('keypress', (e) => {

                if (e.key === 'Enter' && !e.shiftKey) {

                    e.preventDefault();

                    handleQuestionSubmit();

                }

            });

            

            // Export functionality

            document.getElementById('export-data').addEventListener('click', exportData);

        });

    </script>

 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e632e557410bbb',t:'MTc2MzEyMDA1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>

